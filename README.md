# Web-приложение на стеке технологий ASP.NET MVC

## 2 проекта

 1. само приложение
 2. юнит-тесты

## Основной проект

### Общее описание

Это ASP.NET MVC + WEB Api single page приложение.
Серьезных Js фреймворков (типа Angular) не используется. Для оформления интерфейса  применялся Bootstrap.

#### Зависимости

 1. Aspose.Words - триал-версия библиотек для работы с docx
 2. bootstrap 4.5.3
 3. jQuery 3.5.1
 4. MultipartDataMediaFormatter.V2 - чтобы решить проблему с отправкой файла на сервер  модели через ajax
 5. Microsoft.AspNet. ... (множество библиотек для работы самого Asp.Net)
 6. Другие библиотеки, которыми не пользовался или пользовался косвенно (через зависимые элементы)

#### Содержание проекта

* 1 MVC-контроллер - HomeController
* 1 WebApi-контроллер - EncryptorController
* 2 модели:
  1. InputDataModel
  2. EncryptionResultModel
* 1 представление:
  1. Index.cshtml (для HomeController), к нему также относятся Index.js, Site.css.
  2. Мастер страница _Lasyout.cshtml
* В директории ~\Library имеются 3 вспомогательных класса (не относятся к технологиям ASP.NET):
  1. VigenereEncryptor
  2. OldFileCleaner
  3. Extentions
* В директории ~\App_Data созданы 3 папки:
  1. LoadedFiles - для загружаемых на сервер файлов
  2. ResultFiles - для результатов шифрования
  3. Logs - для логов
* Про существующие по умолчанию в шаблоне ASP.NET + MVC + WEB api подробно не буду:
  1. ~\Content\ - .css файлы (bootsrap + Site.css)
  2. ~\App_Start\ - конфигурация приложения (маршруты web api и др.)
  3. ~\Global.asax - Конфигурация приложения + маппинг виртуальных путей директорий в физические + работа с OldFileCleaner
  4. ~\Scripts\ - js файлы, включая Index.js
  5. ~\Views\ - Представления MVC. Нас интересуют только Home\Index.cshtml и Shared\ _Layout.cshtml

#### Классы и методы

* Модели (директория: ~\Models)
  1. InputDataModel  
  Используется для отправки запроса на сервер. Может содержать либо файл(HttpFile), либо текст, введенный с клавиатуры. Обязательно имеет строку - ключевое слово и информацию о том, какое действие с данными произвести - зашифровать или расшифровать.
  2. EncryptionResultModel  
    Имеет всего 2 свойства:
  * bool IsError - ответ, была ли ошибка в процессе работыт с данными  
  * string Content - если была ошибка - здесь будет информация о ней, если все успешно - здесь будет результат шифрования(дешифрования) для предпросмотра.
* Контроллеры (директория: ~\Controllers)
  * HomeController  
  Основной mvc-контроллер.  
  Методы:  
    * public ActionResult Index()  
    Возращается представление Index.cshtml.
  * EncryptorController  
  Класс, отвечающий за обработку клиент-серверных запросов. Работает с имеющимися моделями. Своего представления не имеет (использует Index.cshtml).
  enum:
    * private enum ErrorMsg  
    Соержит набор возвращаемых методами состояний - ошибок. Каждый элемент имеет тектовое описание через атрибут Description.
  Поля:
    * private const string _cookieName - имя сессионного cookie для хранения имени возвращаемого файла с результатом щифрования.
  Методы-обработчики http-запросов:
    * DoCryptography(InputDataModel model)
    * GetFile()
  Вспомогательные методы:
    * ResultFileNameFromCookie
    * TryEncryptFile
    * TryEncryptRawText
    * TryEncryptDocx
    * TryEncryptTxt
* Дополнительные классы (директория: ~\Library)
  * VigenereEncryptor  
  Занимается непосредственно шифрованием/дешифрованием текста.
  Методы
  * ф
  * ф
  * OldFileCleaner  
    Асинхронно через заданные интервалы времени удалаяет из заданной директории файлы, существующие дольше какого-то интервала времени. Используется для очистки файлов в ~\App_Data\ResultFiles.  
    Объект класса создается в методе Application_Start класса WebApiApplication (~\Global.asax).  
    В методе Application_End того же класса выполняется остановка потока очистки.  
    Методы:
    * Конструктор OldFileCleaner
    Задается значения полей и запускает поток очистки.
    * Clean()  
    В бесконечном цикле через время _cleanInterval запускает проверку директории на наличие файлов старше _outdatingInterval и удаляет их.
    * ClearAll()  
    Удаляет все файлы в заднной директории.
    * Abort()  
    Останавливает поток очистки.
  * Extentions  
    Содержит метод расширения GetDescription для извлечения в строковом виде информации из тега Description (System.ComponentModel). Используется для enum ErrorMsg в классе EncryptorController
* ~\Global.asax  
Кроме стандартных действие по конфигурации приложения на запуске, раотает с экземпляром класса OldFileCleaner. Задает ему интервал очистки и время устаревания файлов.

#### Представления

 В директории ~\Views находятся представления.

* Shared\ _Layout.cshtml - глобальное оформление
* Home\Index.cshtml (совместно с ~\Content\Site.css и ~\Scripts.Index.js)  
Это наш фронтэнд.  
Index.cshtml содержит раметку страницы.  
Index.js содерджит следующие компоненты:
  * Глобальная переменная selectedTab, хранящая объект-ссылку на текущую вкладку. Вкладок всего две. Первая - для ввода текста, вторая - для загрузки файла. В зависимости от выбранной вкладки будет отличаться содержание InputDataModel, отправляемого на сервер.
  * Функции:
    * $(document).ready()  
    Выполняет инииацлизацию после полной загрузки страницы. Присваивает начальное значение переменной selectedTab и задает обработчкик для событий переключения вкладок (текст или файл) и выбора файла.
    * function ValidateKeyWord(keyWord)  
    Проверяет, что в ключевом слове только русский символы.
    * function ValidateFileType(fileName)  
    Проверяет, что тип файла .txt или .docx
    * function EnableDownloadBtns(fileType)  
    Включает возможность нажатия кнопки "Скачать результат"
    * function DisableDownloadBtns()  
    Отключает возможность нажатия кнопки "Скачать результат"
    * function SendData(senderName)  
    При нажатии на кнопку "Зашифровать" или "Расшифровать" запускается эта функция. Она проверяет валидность ключевого слова и расширения файла, затем формирует ajax запрос к методу EncryptionController\DoCryptography. Запрос формируется в формате, соответвующем InputDataModel.  
      * В случае успеха запроса: проверяется ответ (в формате EncryptionResultModel). Если ответ сообщает об ошибке обработки (IsError == true) - показывает ее содердимое через alert. Если обработка была успешна (IsError == false) - выводит текст в окно предпросмотра и активирует кнопку скачивания результата.
      * В случае ошибки - сообщает в alert, что с сервером проблемы.

## Проект юнит-тестов



